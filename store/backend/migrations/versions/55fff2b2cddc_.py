"""empty message

Revision ID: 55fff2b2cddc
Revises: 87ce509ca7ba
Create Date: 2024-03-21 22:10:26.133187

"""
from alembic import op
import sqlalchemy as sa
import sqlalchemy_utils
import neurostore.models.migration_types
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = '55fff2b2cddc'
down_revision = '87ce509ca7ba'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_index(op.f('ix_analyses_created_at'), 'analyses', ['created_at'], unique=False)
    op.create_index(op.f('ix_analyses_study_id'), 'analyses', ['study_id'], unique=False)
    op.create_index(op.f('ix_analyses_updated_at'), 'analyses', ['updated_at'], unique=False)
    op.create_index(op.f('ix_analyses_user_id'), 'analyses', ['user_id'], unique=False)
    op.drop_constraint('analysis_conditions_analysis_id_fkey', 'analysis_conditions', type_='foreignkey')
    op.drop_constraint('analysis_conditions_condition_id_fkey', 'analysis_conditions', type_='foreignkey')
    op.create_foreign_key(None, 'analysis_conditions', 'analyses', ['analysis_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(None, 'analysis_conditions', 'conditions', ['condition_id'], ['id'], ondelete='CASCADE')
    op.add_column('annotation_analyses', sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True))
    op.add_column('annotation_analyses', sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True))
    op.add_column('annotation_analyses', sa.Column('user_id', sa.Text(), nullable=True))
    op.create_index(op.f('ix_annotation_analyses_created_at'), 'annotation_analyses', ['created_at'], unique=False)
    op.create_index(op.f('ix_annotation_analyses_updated_at'), 'annotation_analyses', ['updated_at'], unique=False)
    op.create_index(op.f('ix_annotation_analyses_user_id'), 'annotation_analyses', ['user_id'], unique=False)
    op.drop_constraint('annotation_analyses_analysis_id_fkey', 'annotation_analyses', type_='foreignkey')
    op.drop_constraint('annotation_analyses_annotation_id_fkey', 'annotation_analyses', type_='foreignkey')
    op.create_foreign_key(None, 'annotation_analyses', 'analyses', ['analysis_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(None, 'annotation_analyses', 'annotations', ['annotation_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(None, 'annotation_analyses', 'users', ['user_id'], ['external_id'])
    op.create_index(op.f('ix_annotations_created_at'), 'annotations', ['created_at'], unique=False)
    op.create_index(op.f('ix_annotations_studyset_id'), 'annotations', ['studyset_id'], unique=False)
    op.create_index(op.f('ix_annotations_updated_at'), 'annotations', ['updated_at'], unique=False)
    op.create_index(op.f('ix_annotations_user_id'), 'annotations', ['user_id'], unique=False)
    op.drop_constraint('annotations_studyset_id_fkey', 'annotations', type_='foreignkey')
    op.create_foreign_key(None, 'annotations', 'studysets', ['studyset_id'], ['id'], ondelete='CASCADE')
    op.add_column('base_studies', sa.Column('pmcid', sa.String(), nullable=True))
    op.create_index(op.f('ix_base_studies_created_at'), 'base_studies', ['created_at'], unique=False)
    op.create_index(op.f('ix_base_studies_pmcid'), 'base_studies', ['pmcid'], unique=False)
    op.create_index(op.f('ix_base_studies_updated_at'), 'base_studies', ['updated_at'], unique=False)
    op.create_index(op.f('ix_conditions_created_at'), 'conditions', ['created_at'], unique=False)
    op.create_index(op.f('ix_conditions_updated_at'), 'conditions', ['updated_at'], unique=False)
    op.create_index(op.f('ix_conditions_user_id'), 'conditions', ['user_id'], unique=False)
    op.create_index(op.f('ix_entities_analysis_id'), 'entities', ['analysis_id'], unique=False)
    op.create_index(op.f('ix_entities_created_at'), 'entities', ['created_at'], unique=False)
    op.create_index(op.f('ix_entities_updated_at'), 'entities', ['updated_at'], unique=False)
    op.create_index(op.f('ix_image_entities_entity'), 'image_entities', ['entity'], unique=False)
    op.create_index(op.f('ix_image_entities_image'), 'image_entities', ['image'], unique=False)
    op.create_index(op.f('ix_images_analysis_id'), 'images', ['analysis_id'], unique=False)
    op.create_index(op.f('ix_images_created_at'), 'images', ['created_at'], unique=False)
    op.create_index(op.f('ix_images_updated_at'), 'images', ['updated_at'], unique=False)
    op.create_index(op.f('ix_images_user_id'), 'images', ['user_id'], unique=False)
    op.create_index(op.f('ix_point_entities_entity'), 'point_entities', ['entity'], unique=False)
    op.create_index(op.f('ix_point_entities_point'), 'point_entities', ['point'], unique=False)
    op.create_index(op.f('ix_point_values_created_at'), 'point_values', ['created_at'], unique=False)
    op.create_index(op.f('ix_point_values_point_id'), 'point_values', ['point_id'], unique=False)
    op.create_index(op.f('ix_point_values_updated_at'), 'point_values', ['updated_at'], unique=False)
    op.create_index(op.f('ix_point_values_user_id'), 'point_values', ['user_id'], unique=False)
    op.create_index(op.f('ix_points_analysis_id'), 'points', ['analysis_id'], unique=False)
    op.create_index(op.f('ix_points_created_at'), 'points', ['created_at'], unique=False)
    op.create_index(op.f('ix_points_updated_at'), 'points', ['updated_at'], unique=False)
    op.create_index(op.f('ix_points_user_id'), 'points', ['user_id'], unique=False)
    op.create_index(op.f('ix_roles_created_at'), 'roles', ['created_at'], unique=False)
    op.create_index(op.f('ix_roles_updated_at'), 'roles', ['updated_at'], unique=False)
    op.add_column('studies', sa.Column('pmcid', sa.String(), nullable=True))
    op.create_index(op.f('ix_studies_base_study_id'), 'studies', ['base_study_id'], unique=False)
    op.create_index(op.f('ix_studies_created_at'), 'studies', ['created_at'], unique=False)
    op.create_index(op.f('ix_studies_pmcid'), 'studies', ['pmcid'], unique=False)
    op.create_index(op.f('ix_studies_updated_at'), 'studies', ['updated_at'], unique=False)
    op.create_index(op.f('ix_studysets_created_at'), 'studysets', ['created_at'], unique=False)
    op.create_index(op.f('ix_studysets_updated_at'), 'studysets', ['updated_at'], unique=False)
    op.create_index(op.f('ix_studysets_user_id'), 'studysets', ['user_id'], unique=False)
    op.drop_column('studysets', '__ts_vector__')
    op.create_index(op.f('ix_users_created_at'), 'users', ['created_at'], unique=False)
    op.create_index(op.f('ix_users_updated_at'), 'users', ['updated_at'], unique=False)
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_users_updated_at'), table_name='users')
    op.drop_index(op.f('ix_users_created_at'), table_name='users')
    op.add_column('studysets', sa.Column('__ts_vector__', postgresql.TSVECTOR(), sa.Computed("to_tsvector('english'::regconfig, (((COALESCE(name, ''::character varying))::text || ' '::text) || (COALESCE(description, ''::character varying))::text))", persisted=True), autoincrement=False, nullable=True))
    op.drop_index(op.f('ix_studysets_user_id'), table_name='studysets')
    op.drop_index(op.f('ix_studysets_updated_at'), table_name='studysets')
    op.drop_index(op.f('ix_studysets_created_at'), table_name='studysets')
    op.drop_index(op.f('ix_studies_updated_at'), table_name='studies')
    op.drop_index(op.f('ix_studies_pmcid'), table_name='studies')
    op.drop_index(op.f('ix_studies_created_at'), table_name='studies')
    op.drop_index(op.f('ix_studies_base_study_id'), table_name='studies')
    op.drop_column('studies', 'pmcid')
    op.drop_index(op.f('ix_roles_updated_at'), table_name='roles')
    op.drop_index(op.f('ix_roles_created_at'), table_name='roles')
    op.drop_index(op.f('ix_points_user_id'), table_name='points')
    op.drop_index(op.f('ix_points_updated_at'), table_name='points')
    op.drop_index(op.f('ix_points_created_at'), table_name='points')
    op.drop_index(op.f('ix_points_analysis_id'), table_name='points')
    op.drop_index(op.f('ix_point_values_user_id'), table_name='point_values')
    op.drop_index(op.f('ix_point_values_updated_at'), table_name='point_values')
    op.drop_index(op.f('ix_point_values_point_id'), table_name='point_values')
    op.drop_index(op.f('ix_point_values_created_at'), table_name='point_values')
    op.drop_index(op.f('ix_point_entities_point'), table_name='point_entities')
    op.drop_index(op.f('ix_point_entities_entity'), table_name='point_entities')
    op.drop_index(op.f('ix_images_user_id'), table_name='images')
    op.drop_index(op.f('ix_images_updated_at'), table_name='images')
    op.drop_index(op.f('ix_images_created_at'), table_name='images')
    op.drop_index(op.f('ix_images_analysis_id'), table_name='images')
    op.drop_index(op.f('ix_image_entities_image'), table_name='image_entities')
    op.drop_index(op.f('ix_image_entities_entity'), table_name='image_entities')
    op.drop_index(op.f('ix_entities_updated_at'), table_name='entities')
    op.drop_index(op.f('ix_entities_created_at'), table_name='entities')
    op.drop_index(op.f('ix_entities_analysis_id'), table_name='entities')
    op.drop_index(op.f('ix_conditions_user_id'), table_name='conditions')
    op.drop_index(op.f('ix_conditions_updated_at'), table_name='conditions')
    op.drop_index(op.f('ix_conditions_created_at'), table_name='conditions')
    op.drop_index(op.f('ix_base_studies_updated_at'), table_name='base_studies')
    op.drop_index(op.f('ix_base_studies_pmcid'), table_name='base_studies')
    op.drop_index(op.f('ix_base_studies_created_at'), table_name='base_studies')
    op.drop_column('base_studies', 'pmcid')
    op.drop_constraint(None, 'annotations', type_='foreignkey')
    op.create_foreign_key('annotations_studyset_id_fkey', 'annotations', 'studysets', ['studyset_id'], ['id'])
    op.drop_index(op.f('ix_annotations_user_id'), table_name='annotations')
    op.drop_index(op.f('ix_annotations_updated_at'), table_name='annotations')
    op.drop_index(op.f('ix_annotations_studyset_id'), table_name='annotations')
    op.drop_index(op.f('ix_annotations_created_at'), table_name='annotations')
    op.drop_constraint(None, 'annotation_analyses', type_='foreignkey')
    op.drop_constraint(None, 'annotation_analyses', type_='foreignkey')
    op.drop_constraint(None, 'annotation_analyses', type_='foreignkey')
    op.create_foreign_key('annotation_analyses_annotation_id_fkey', 'annotation_analyses', 'annotations', ['annotation_id'], ['id'])
    op.create_foreign_key('annotation_analyses_analysis_id_fkey', 'annotation_analyses', 'analyses', ['analysis_id'], ['id'])
    op.drop_index(op.f('ix_annotation_analyses_user_id'), table_name='annotation_analyses')
    op.drop_index(op.f('ix_annotation_analyses_updated_at'), table_name='annotation_analyses')
    op.drop_index(op.f('ix_annotation_analyses_created_at'), table_name='annotation_analyses')
    op.drop_column('annotation_analyses', 'user_id')
    op.drop_column('annotation_analyses', 'updated_at')
    op.drop_column('annotation_analyses', 'created_at')
    op.drop_constraint(None, 'analysis_conditions', type_='foreignkey')
    op.drop_constraint(None, 'analysis_conditions', type_='foreignkey')
    op.create_foreign_key('analysis_conditions_condition_id_fkey', 'analysis_conditions', 'conditions', ['condition_id'], ['id'])
    op.create_foreign_key('analysis_conditions_analysis_id_fkey', 'analysis_conditions', 'analyses', ['analysis_id'], ['id'])
    op.drop_index(op.f('ix_analyses_user_id'), table_name='analyses')
    op.drop_index(op.f('ix_analyses_updated_at'), table_name='analyses')
    op.drop_index(op.f('ix_analyses_study_id'), table_name='analyses')
    op.drop_index(op.f('ix_analyses_created_at'), table_name='analyses')
    # ### end Alembic commands ###
